require 'rake'
#require 'rake/clean'
require 'colorize'
require 'logger'

$stdout.sync = true

logger = Logger.new(STDOUT)
logger.formatter = proc do |severity, datetime, progname, msg|
  "#{severity} #{datetime}: #{msg}\n"
end

os = RbConfig::CONFIG["host_os"]
homeDir = ENV["HOME"]

logger.info "You are runnig on " + os.yellow

task :default => %w[create_config]

task :create_config do
  if File.exists?("#{homeDir}/.opcontoken.yaml")
    logger.info "Config-file already exists.".red
    puts "Edit file manually or rename it."
  else
    print "Enter hostname:port for prod-stage: "
    server = STDIN.gets.chomp
    print "Enter external token for prod-stage: "
    token = STDIN.gets.chomp
    puts "writing config to #{homeDir}/.opcontoken.yaml ...".yellow
    f = File.open("#{homeDir}/.opcontoken.yaml", 'w')
    f.puts "server_prodstage: \"#{server}\""
    f.puts "external_token_prodstage: \"#{token}\""

    print "Enter hostname:port for test-stage: "
    server = STDIN.gets.chomp
    print "Enter external token for test-stage: "
    token = STDIN.gets.chomp
    puts "writing config to #{homeDir}/.opcontoken.yaml ...".yellow
    f = File.open("#{homeDir}/.opcontoken.yaml", 'w')
    f.puts "server_teststage: \"#{server}\""
    f.puts "external_token_teststage: \"#{token}\""

    print "Enter hostname:port for dev-stage: "
    server = STDIN.gets.chomp
    print "Enter external token for dev-stage: "
    token = STDIN.gets.chomp
    puts "writing config to #{homeDir}/.opcontoken.yaml ...".yellow
    f = File.open("#{homeDir}/.opcontoken.yaml", 'w')
    f.puts "server_devstage: \"#{server}\""
    f.puts "external_token_devstage: \"#{token}\""

    f.close
    puts "Thank you."
  end
end
